# 메모리

> Value type (복사)
    
    - struct, enum, tuple, String, Array, Dictionary 등
    원본이 한개가 있으면 그 값을 복사해 복사한 값으로 각각 사용
    각각 따로 관리되기 때문에 원본에 대한 관리가 필요없음
    COW(Copy On Write)로 성능 저하 방지
```swift
//Value type (복사)
var score1 = 100
var scoreA = score1
var scoreB = scoreA

scoreA = 50
/*
score1 = 100
scoreA = 50
scoreB = 100
*/
```
   
> Reference type (참조)
   
    - calss, func, closure
     원본이 한개가 있으면 그 하나를 가지고 여러곳에서 같이 사용
     원본에 대한 관리 필요(멀티 스레드 환경에서 오류발생 가능성)
```swift
//Reference type (참조)
var score1 = 100
var scoreA = score1
var scoreB = scoreA

scoreA = 50
/*
score1 = 100
scoreA = 50
scoreB = 50
*/
```

----
# 메모리 영역

프로그램이 실행되면 운영체제(OS)는 메모리(RAM)에 이 프로그램을 위한 공간을 할당해 줌

그 공간은 Code, Data, Heap, Stack가 있다.

```
다음과 같은 순서대로 쌓여있다.

1. 코드 영역

2. 데이터 영역

3. 힙 영역

4. 스택 영역
```

---

1. 코드영역

우리가 작성한 소스 코드가 기계어 형태로 저장된다.

컴파일 타임에 결정되고, 중간에 코드가 변경되지 않도록 Read-Only 형태로 저장된다.

---

1. 데이터 영역

전역변수, static 변수가 저장된다.

프로그램 시작과 동시에 할당되고, 프로그램이 종료 되어야 메모리가 해제된다.

실행 도중 변수 값이 변경될 수 있으니 Read-Write로 저장된다.

---

1. 힙 영역

프로그래머가 할당/해제 하는 메모리 영역

프로그래머는 malloc, calloc으로 힙에 메모리를 할당할 수 있으며, 이를 `동적 할당`이라고 한다.

사용하고 난 후에는 반드시 메모리 해제를 해줘야 한다 그렇지 않으면 memory leak가 발생한다.

Code, Data, Stack 중 유일하게 런타임 시 결정되기 때문에 데이터의 크기가 확실하지 않을 때 사용한다.

힙 영역의 장점

1. 메모리 크기에 대한 제한 없음
2. 본질적인 범위가 전역이기 때문에, 프로그램의 모든 함수에서 액세스 할 수 있음

힙 영역의 단점

1. 할당작업, 해제 작업으로 인한 속도 저하
2. 힙 손상 작업으로 인한 속도 저하
3. 힙 경합으로 인한 속도 저하
4. 메모리를 직접 관리해야 함

---

1. 스택 영역

함수 호출 시 함수의 지역변수, 매개변수, 리턴 값 등등이 저장되고, 함수가 종료되면 저장된 메모리도 해제된다.

컴파일 타임에 결정되기 때문에 무한히 할당할 수 없다.

스택 영역의 장점

1. CPU가 스택 메모리를 효율적으로 구성하기 때문에 속도가 매우 빠름
2. 메모리를 직접 해제해주지 않아도 됨

스택 영역의 단점

1. 메모리 크기에 대한 제한 있음
2. 지역 변수만 액세스 가능

---

1. 힙 VS 스택

스택은 메모리가 한정되어 있기 때문에 너무 큰 메모리는 할당될 수 없음

따라서 데이터의 크기를 모르거나, 스택에 저장하기엔 큰 데이터의 경우엔 힙에 할당, 그 외엔 스택에 할당

---

1. 힙과 스택의 메모리 관계

힙과 스택은 같은 메모리 영역을 공유

힙 영역은 낮은 메모리 주소부터 할당

스택 영역은 높은 메모리 주소부터 할당